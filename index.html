<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Psicocare</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f6f9; }
    h1 { text-align: center; margin-bottom: 20px; }
    .filtros { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center; }
    .valor { font-size: 28px; font-weight: bold; margin-top: 10px; }
    .graficos { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
    canvas { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>ðŸ“Š Dashboard Psicocare</h1>

  <!-- Filtros -->
  <div class="filtros">
    <div>
      <label for="dataInicio">Data inÃ­cio:</label>
      <input type="date" id="dataInicio">
    </div>
    <div>
      <label for="dataFim">Data fim:</label>
      <input type="date" id="dataFim">
    </div>
    <button onclick="atualizarDashboard()">Filtrar</button>
  </div>

  <!-- KPIs -->
  <div class="grid">
    <div class="card">
      <h3>Total de Atendimentos</h3>
      <div class="valor" id="atendimentos">0</div>
    </div>
    <div class="card">
      <h3>Receita (R$)</h3>
      <div class="valor" id="receita">0</div>
    </div>
    <div class="card">
      <h3>Crescimento (%)</h3>
      <div class="valor" id="crescimento">0%</div>
    </div>
  </div>

  <!-- GrÃ¡ficos -->
  <div class="graficos">
    <canvas id="graficoLinha"></canvas>
    <canvas id="graficoBarra"></canvas>
    <canvas id="graficoPizza"></canvas>
  </div>

  <script>
    let dadosPlanilha = []; // Armazena todos os dados
    let chartLinha, chartBarra, chartPizza;

    async function carregarDados() {
      // ðŸ”— Troque pelo link da sua planilha publicada em CSV
      // Exemplo: https://docs.google.com/spreadsheets/d/SEU_ID/export?format=csv
      const url = "https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv";

      const response = await fetch(url);
      const texto = await response.text();
      const linhas = texto.split("\n").slice(1);

      dadosPlanilha = linhas.map(linha => {
        const [data, atendimentos, receita, categoria] = linha.split(",");
        return {
          data: new Date(data),
          atendimentos: Number(atendimentos),
          receita: Number(receita),
          categoria: categoria || "Outros"
        };
      });

      atualizarDashboard();
    }

    function atualizarDashboard() {
      const inicio = document.getElementById("dataInicio").value ? new Date(document.getElementById("dataInicio").value) : null;
      const fim = document.getElementById("dataFim").value ? new Date(document.getElementById("dataFim").value) : null;

      const filtrados = dadosPlanilha.filter(d => {
        return (!inicio || d.data >= inicio) && (!fim || d.data <= fim);
      });

      let totalAtendimentos = 0;
      let totalReceita = 0;
      const datas = [];
      const atendimentosDiarios = [];
      const receitasMensais = {};
      const distribuicao = {};

      filtrados.forEach(d => {
        totalAtendimentos += d.atendimentos;
        totalReceita += d.receita;

        datas.push(d.data.toLocaleDateString("pt-BR"));
        atendimentosDiarios.push(d.atendimentos);

        const mes = d.data.getFullYear() + "-" + String(d.data.getMonth()+1).padStart(2,"0");
        receitasMensais[mes] = (receitasMensais[mes] || 0) + d.receita;

        distribuicao[d.categoria] = (distribuicao[d.categoria] || 0) + d.atendimentos;
      });

      // KPIs
      document.getElementById("atendimentos").innerText = totalAtendimentos;
      document.getElementById("receita").innerText = totalReceita.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
      document.getElementById("crescimento").innerText = ((totalAtendimentos / 1000) * 100).toFixed(1) + "%";

      // Atualizar grÃ¡ficos
      if(chartLinha) chartLinha.destroy();
      if(chartBarra) chartBarra.destroy();
      if(chartPizza) chartPizza.destroy();

      chartLinha = new Chart(document.getElementById("graficoLinha"), {
        type: "line",
        data: {
          labels: datas,
          datasets: [{
            label: "Atendimentos por dia",
            data: atendimentosDiarios,
            borderColor: "blue",
            backgroundColor: "rgba(0,0,255,0.2)",
            fill: true,
            tension: 0.3
          }]
        }
      });

      chartBarra = new Chart(document.getElementById("graficoBarra"), {
        type: "bar",
        data: {
          labels: Object.keys(receitasMensais),
          datasets: [{
            label: "Receita Mensal (R$)",
            data: Object.values(receitasMensais),
            backgroundColor: "rgba(0,150,136,0.7)"
          }]
        }
      });

      chartPizza = new Chart(document.getElementById("graficoPizza"), {
        type: "pie",
        data: {
          labels: Object.keys(distribuicao),
          datasets: [{
            data: Object.values(distribuicao),
            backgroundColor: ["#2196f3","#ff9800","#4caf50","#e91e63","#9c27b0"]
          }]
        }
      });
    }

    carregarDados();
  </script>
</body>
</html>
